# terrain

Set of classes and materials to help with visualizing various terrain artifacts.

<!--{example terrain-rendering.js}-->

<!--{package-dependencies ./package.json}-->

# Use

TODO

# API

<!-- START_AUTOGENERATED_DOCS -->
## RenderMode

### POINTS<a name="RenderMode#POINTS"></a>

```js
POINTS : 0
```


Render the terrain as points.


### MESH<a name="RenderMode#MESH"></a>

```js
MESH : 1
```


Render the terrain as a mesh.


### INSTANCE_POINTS<a name="RenderMode#INSTANCE_POINTS"></a>

```js
INSTANCE_POINTS : 2
```


Render the terrain as instanced points.


## Terrain

Terrain class for rendering geometry or set of data as a mesh, points, or voxels.

_extends SwitchGroup_

### renderMode<a name="Terrain#renderMode"></a>

```js
renderMode : RenderMode
```


An alias for [SwitchGroup.active](#SwitchGroup#active)


### points<a name="Terrain#points"></a>

```js
points : Points
```


Reference to the child used for rendering Points.


### mesh<a name="Terrain#mesh"></a>

```js
mesh : Mesh
```


Reference to the child used for rendering Mesh.


### instancedPoints<a name="Terrain#instancedPoints"></a>

```js
instancedPoints : Mesh
```


Reference to the child used for rendering Voxels.


### constructor

```js
constructor( geometry : BufferGeometry, baseShader : Shader = ShaderLib.phong ) : void
```

Takes the geometry and shader used to render the meshes.

### update<a name="Terrain#update"></a>

```js
update(  ) : void
```

Must be called when the geometry changes or data affecting dynamic geometry has changed.

### updateGeometry<a name="Terrain#updateGeometry"></a>

```js
updateGeometry( geometry : BufferGeometry ) : void
```

Overrideable function called when dynamic geometry msut be updated.

## HeightMapTerrain

Height map base class that defines a plane that can be used for
visualizing a height map.

_extends Terrain_

### args<a name="HeightMapTerrain#args"></a>

```js
args : ...null
```



### _setGridDimensions<a name="HeightMapTerrain#_setGridDimensions"></a>

```js
_setGridDimensions( geometry : BufferGeometry, width : Number, height : Number ) : Boolean
```

Ensures the grid dimensions are set to the given values.
If they are not a new plane geometry is created and the old one
is discarded. Returns a boolean indicating whether or not the
geometry was replaced.

Private function intended to be called internally when implementing
[Terrain.updateGeometry](#Terrain#updateGeometry) function.

## StructuredPointCloudTerrain

TODO

_extends HeightMapTerrain_

### pointCloudData<a name="StructuredPointCloudTerrain#pointCloudData"></a>

```js
pointCloudData : null = null
```



### cameraData<a name="StructuredPointCloudTerrain#cameraData"></a>

```js
cameraData : null = null
```



### zScale<a name="StructuredPointCloudTerrain#zScale"></a>

```js
zScale : null = 1
```



### cellWidth<a name="StructuredPointCloudTerrain#cellWidth"></a>

```js
cellWidth : null = 1
```



### material<a name="StructuredPointCloudTerrain#material"></a>

```js
material : null = null
```



## RosPointCloudTerrain

TODO

_extends Terrain_

### args<a name="RosPointCloudTerrain#args"></a>

```js
args : ...null
```



## SwitchGroup

Class for toggling visibility of children based on an active flag.

_extends Group_

### active<a name="SwitchGroup#active"></a>

```js
active : Number = 0
```


The flag indicating which child is visible.


### items<a name="SwitchGroup#items"></a>

```js
items : null = []
```



## SampledTerrain

Heightmap class that derives and updates the heightmap based on
a Sampler2D object.

_extends HeightMapTerrain_

### sampler<a name="SampledTerrain#sampler"></a>

```js
sampler : Sampler2D
```


The Sampler2D object to use when retriving values to position the
Z component of the vertices.


### resolution<a name="SampledTerrain#resolution"></a>

```js
resolution : Number = -1
```


The sampling resolution to use when genering the number of vertices on each
dimension of the heightmap. If set to - 1 then [samples](#SampledTerrain#samples)
will be used to determine the number of verts.

For example 0.1 will sample the map ever 10 cm.


### maxSamplesPerDimension<a name="SampledTerrain#maxSamplesPerDimension"></a>

```js
maxSamplesPerDimension : maxSamplesPerDimension = Infinity
```


The maximum number of samples per dimension of the heightmap. Useful for ensuring
the heightmap does not consume too much memory or take too much time to update.


### samples<a name="SampledTerrain#samples"></a>

```js
samples : samples = (0, 0)
```


The number of vertices to generate on X and Y of the heightmap. Only used if
[#SampledTerrain#resolution](#SampledTerrain#resolution) is set to `-1`.


### channel<a name="SampledTerrain#channel"></a>

```js
channel : channel = 0
```


The channel from the Sampler2D to use for the height value.


### sampleInWorldFrame<a name="SampledTerrain#sampleInWorldFrame"></a>

```js
sampleInWorldFrame : sampleInWorldFrame = true
```


Whether or not to use the `Sampler2D.spatialSampleChannel` function when sampling
the heightmap. Useful for sampling a heightmap that has a spatial offset or sampling
a sub portion of the map.


### sampleMatrix<a name="SampledTerrain#sampleMatrix"></a>

```js
sampleMatrix : sampleMatrix
```


3x3 2D transform matrix for transforming the positon of the xy sample positions. Useful
for generating a heightmap that is offset from the origin.


### args<a name="SampledTerrain#args"></a>

```js
args : ...null
```



### getBoundsRotation<a name="SampledTerrain#getBoundsRotation"></a>

```js
getBoundsRotation(  ) : Number
```

Returns the rotation of the heightmap based on the [#SampledTerrain#sampleMatrix](#SampledTerrain#sampleMatrix).

### getBoundsCenter<a name="SampledTerrain#getBoundsCenter"></a>

```js
getBoundsCenter( target : Vector2 ) : void
```

Returns the center of the heightmap in `target` based on the [#SampledTerrain#sampleMatrix](#SampledTerrain#sampleMatrix).

### getBoundsSize<a name="SampledTerrain#getBoundsSize"></a>

```js
getBoundsSize( target : Vector2 ) : void
```

Returns the size of the heightmap in `target` based on the [#SampledTerrain#sampleMatrix](#SampledTerrain#sampleMatrix).

### setBounds<a name="SampledTerrain#setBounds"></a>

```js
setBounds(
	minX : Number, 
	minY : Number, 
	maxX : Number, 
	maxY : Number, 
	rotation : Number = 0
) : void
```

Sets the bounds of the heightmap patch to generate.

### convertToSampleWorldFrame<a name="SampledTerrain#convertToSampleWorldFrame"></a>

```js
convertToSampleWorldFrame(  ) : void
```

Sets the [#SampledTerrain#sampleInWorldFrame](#SampledTerrain#sampleInWorldFrame) field to true and adjusts [#SampledTerrain#sampler](#SampledTerrain#sampler)
inverseMatrix so the terrain is sampled in world frame but is visually unchanged.


<!-- END_AUTOGENERATED_DOCS -->

## Other

### Generating `wNormalMatrix`

From the [THREEjs Docs](https://threejs.org/docs/#api/en/renderers/webgl/WebGLProgram), the normal matrix is the "inverse transpose of modelViewMatrix":

```js
const scene = ...;
const material = ...;
const mesh = ...;

// ensure the world matrix is up to date
scene.add(mesh);
mesh.updateMatrixWorld(true);

// generate the normal matrix
material
    .wNormalMatrix
    .copy(mesh.matrixWorld).invert()
    .transpose();
```
